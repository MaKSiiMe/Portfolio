<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>UNO Game</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #5c2ca4;
            color: white;
            overflow: hidden;
        }

        .player {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
        }

        .player img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid gold;
        }

        #player-bottom { bottom: 10px; left: 50%; transform: translateX(-50%); }
        #player-top { top: 10px; left: 50%; transform: translateX(-50%); }
        #player-left { top: 50%; left: 10px; transform: translateY(-50%); }
        #player-right { top: 50%; right: 10px; transform: translateY(-50%); }

        #center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        #deck, #discard {
            width: 80px;
            height: 120px;
            background-color: #fff;
            border-radius: 10px;
            display: inline-block;
            margin: 0 20px;
            font-size: 24px;
            color: black;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #hand {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .hand-container {
            position: absolute;
            display: flex;
            flex-wrap: wrap;
        }

        #hand-top {
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
        }

        #hand-left {
            top: 50%;
            left: 80px;
            transform: translateY(-50%) rotate(-90deg);
        }

        #hand-right {
            top: 50%;
            right: 80px;
            transform: translateY(-50%) rotate(90deg);
        }

        .card {
            width: 60px;
            height: 90px;
            background-color: #000;
            color: yellow;
            border-radius: 8px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: scale(1.1);
        }

        .card.back {
            background-color: gray;
            color: transparent;
            cursor: default;
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            background: orange;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Joueurs -->
    <div class="player" id="player-top">
        <img src="avatar1.png" alt="Joueur 1">
        <span>å¸‚é‡Ž</span>
    </div>
    <div class="player" id="player-left">
        <img src="avatar2.png" alt="Joueur 2">
        <span>Nelson Orozco</span>
    </div>
    <div class="player" id="player-right">
        <img src="avatar3.png" alt="Joueur 3">
        <span>Micaela Scott</span>
    </div>
    <div class="player" id="player-bottom">
        <img src="avatar4.png" alt="Moi">
        <span>Moi</span>
    </div>

    <!-- Mains des autres joueurs (face cachÃ©e) -->
    <div class="hand-container" id="hand-top"></div>
    <div class="hand-container" id="hand-left"></div>
    <div class="hand-container" id="hand-right"></div>

    <!-- Plateau central -->
    <div id="center">
        <div id="deck">Pioche</div>
        <div id="discard">Carte</div>
        <button onclick="drawCard()">Piocher</button>
    </div>

    <!-- Ta main -->
    <div id="hand"></div>

    <script src="api.js"></script>
    <script>
        async function getColorEmoji(color) {
            switch (color) {
                case "Red": return "ðŸ”´";
                case "Green": return "ðŸŸ¢";
                case "Blue": return "ðŸ”µ";
                case "Yellow": return "ðŸŸ¡";
                case "Black": return "â¬›";
                default: return "";
            }
        }

        async function updateHand(hand) {
            const handDiv = document.getElementById("hand");
            handDiv.innerHTML = "";

            for (let i = 0; i < hand.length; i++) {
                const card = hand[i];
                const cardDiv = document.createElement("div");
                cardDiv.className = "card";
                cardDiv.textContent = `${card.value}${await getColorEmoji(card.color)}`;
                cardDiv.onclick = () => playTurn(i);
                handDiv.appendChild(cardDiv);
            }
        }

        function renderHiddenHand(containerId, count) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            for (let i = 0; i < count; i++) {
                const div = document.createElement("div");
                div.className = "card back";
                container.appendChild(div);
            }
        }

        async function refreshGameState() {
            const response = await fetch("http://localhost:5000/api/get_state");
            const data = await response.json();

            const state = data.state;
            const current = state.current_player;
            const hands = state.hands;

            // Affiche ta main
            await updateHand(hands[current]);

            // Affiche les autres joueurs
            const playerIndexes = [0, 1, 2, 3];
            const positions = ["top", "left", "right"];
            let posIndex = 0;

            for (let i = 0; i < hands.length; i++) {
                if (i !== current) {
                    const handLength = hands[i].length;
                    renderHiddenHand("hand-" + positions[posIndex], handLength);
                    posIndex++;
                }
            }

            // Affiche la carte jouÃ©e
            const topCard = state.top_card;
            document.getElementById("discard").textContent =
                `${topCard.value}${await getColorEmoji(topCard.color)}`;
        }

        async function drawCard() {
            await fetch("http://localhost:5000/api/draw_card");
            await refreshGameState();
        }

        async function playTurn(index) {
            const response = await fetch("http://localhost:5000/api/play_turn", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ card_index: index })
            });

            const data = await response.json();

            if (data.error) {
                alert(data.error);
            } else if (data.winner !== null) {
                alert(`Le joueur ${data.winner} a gagnÃ© !`);
            }

            await refreshGameState();
        }

        window.onload = async () => {
            createGame(4);
            await new Promise(r => setTimeout(r, 500));
            await start();
            await new Promise(r => setTimeout(r, 500));
            await handle_first_card();
            await refreshGameState();
        };
    </script>
</body>
</html>
